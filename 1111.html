<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>11.11 量子脱单引擎</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;500;700&display=swap');
  :root {
    --primary: #ff69b4;
    --accent: #ff1493;
    --bg-dark: #0a0a1a;
    --text-light: #fff;
    --glow-pink: 0 0 20px #ff1493;
    --glow-cyan: 0 0 15px #00ffff;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body,html{height:100%;font-family:'Noto Sans SC',sans-serif;background:var(--bg-dark);color:var(--text-light);overflow:hidden;position:relative;}
  
  /* 星空背景 */
  .stars{position:absolute;inset:0;background:transparent;z-index:1;}
  
  /* 花瓣雨 Canvas */
  #heartCanvas{position:absolute;inset:0;width:100%;height:100%;z-index:2;pointer-events:none;}
  
  /* 烟花 Canvas */
  #fireworksCanvas{position:absolute;inset:0;width:100%;height:100%;z-index:3;display:none;pointer-events:none;}
  
  /* 主容器 */
  #app{position:relative;z-index:10;width:100%;height:100%;display:flex;align-items:center;justify-content:center;padding:20px;}
  
  /* 场景切换 */
  .scene{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:0;transform:scale(0.95);transition:opacity .8s ease,transform .8s ease;pointer-events:none;}
  .scene.active{opacity:1;transform:scale(1);pointer-events:auto;}
  
  /* 标题 */
  h1{font-size:2.8rem;margin:.5rem;color:var(--primary);font-weight:700;text-shadow:var(--glow-pink);}
  
  /* 提示文字 */
  .subtitle{font-size:1.3rem;color:#ffb3d1;margin:8px 0;opacity:0;transform:translateY(15px);transition:all .6s ease;}
  .subtitle.show{opacity:1;transform:translateY(0);}
  
  /* 按钮 */
  button{
    font-size:1.3rem;padding:14px 36px;border:2px solid var(--primary);border-radius:50px;
    background:transparent;color:var(--primary);cursor:pointer;transition:all .4s ease;
    box-shadow:var(--glow-pink);position:relative;overflow:hidden;z-index:11;
  }
  button::before{content:'';position:absolute;inset:0;background:var(--accent);transform:scaleX(0);transform-origin:left;transition:transform .4s ease;z-index:-1;}
  button:hover::before{transform:scaleX(1);}
  button:hover{background:var(--accent);color:#fff;transform:scale(1.05);box-shadow:0 0 25px var(--primary);}
  button:active{transform:scale(0.98);}
  
  /* 进度条 */
  #progressContainer{margin:30px 0;width:80%;max-width:450px;height:6px;background:rgba(255,255,255,.1);border-radius:3px;overflow:hidden;display:none;}
  #progress{height:100%;width:0;background:linear-gradient(90deg,var(--primary),var(--accent));box-shadow:var(--glow-pink);transition:width .1s linear;position:relative;}
  #progress::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,#fff,transparent);animation:shimmer 1.5s infinite;}
  @keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
  
  /* 关系图容器 */
  #graphContainer{position:relative;width:100%;max-width:600px;height:420px;display:none;overflow:hidden;border-radius:16px;background:rgba(10,10,30,.8);box-shadow:0 0 30px rgba(255,105,180,.3);margin:20px 0;}
  #graphCanvas{position:absolute;inset:0;width:100%;height:100%;}
  .scan-line{position:absolute;top:0;left:0;width:100%;height:2px;background:linear-gradient(90deg,transparent,#0f0,#0f0,transparent);box-shadow:var(--glow-cyan);animation:scan 2.5s linear infinite;opacity:0;}
  @keyframes scan{0%{top:0}100%{top:100%}}
  
  /* 狗狗 */
  .doggo{width:160px;height:160px;background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23f4a261"/><circle cx="35" cy="40" r="8" fill="%23000"/><circle cx="65" cy="40" r="8" fill="%23000"/><path d="M30 60 Q40 70 50 70 T70 60" stroke="%23000" stroke-width="3" fill="none"/><text x="50" y="90" font-size="14" text-anchor="middle" fill="%23fff">Dog</text></svg>') center/contain no-repeat;animation:wiggle .5s infinite alternate;opacity:0;transform:scale(0);}
  @keyframes wiggle{0%{transform:rotate(-6deg)}100%{transform:rotate(6deg)}}
  
  /* 结果文字 */
  #finalText{font-size:2rem;text-align:center;margin:25px;color:var(--primary);font-weight:500;line-height:1.6;opacity:0;transform:translateY(20px);transition:all .8s ease;}
  #finalText.show{opacity:1;transform:translateY(0);}
  
  /* 梗图 */
  .meme{width:240px;margin:20px auto;opacity:0;transform:scale(0) rotate(-10deg);transition:all .8s ease;}
  .meme.show{opacity:1;transform:scale(1) rotate(0);}
  .meme img{width:100%;border-radius:12px;box-shadow:0 8px 20px rgba(255,105,180,.4);}
  
  /* 脉冲波纹 */
  .pulse-circle{position:absolute;width:20px;height:20px;border:2px solid var(--primary);border-radius:50%;opacity:0;pointer-events:none;z-index:12;}
  @keyframes pulse{0%{transform:scale(0);opacity:1}100%{transform:scale(4);opacity:0}}
  
  /* 浮动粒子 */
  .float-particle{position:absolute;font-size:1.5rem;opacity:0;pointer-events:none;animation:floatUp 2s ease-out forwards;z-index:12;}
  @keyframes floatUp{0%{transform:translateY(0);opacity:1}100%{transform:translateY(-100px);opacity:0}}
</style>
</head>
<body>

<!-- 星空 -->
<div class="stars" id="stars"></div>

<!-- 花瓣雨 -->
<canvas id="heartCanvas"></canvas>

<!-- 烟花 -->
<canvas id="fireworksCanvas"></canvas>

<!-- 主内容 -->
<div id="app">
  <!-- 开始页 -->
  <div id="startScene" class="scene active">
    <h1>量子脱单引擎 v11.11</h1>
    <p class="subtitle" data-delay="300">你可能不知道，</p>
    <p class="subtitle" data-delay="900">不知不觉今天已经是 <strong>11.11</strong>，</p>
    <p class="subtitle" data-delay="1500">全球 114514 名单身用户正在等待匹配…</p>
    <button id="startBtn">立即启动引擎</button>
  </div>

  <!-- 匹配页 -->
  <div id="loadingScene" class="scene">
    <h1>神经网络匹配中…</h1>
    <div id="progressContainer"><div id="progress"></div></div>
    <div id="graphContainer">
      <canvas id="graphCanvas"></canvas>
      <div class="scan-line"></div>
    </div>
    <p id="tip">正在构建高维社交关系图…</p>
  </div>

  <!-- 结果页 -->
  <div id="resultScene" class="scene">
    <div class="doggo" id="doggo"></div>
    <h1 id="finalText">匹配完成！<br>你的灵魂伴侣是……</h1>
    <div class="meme" id="meme">
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 200'><rect width='300' height='200' fill='%23fff3f9' rx='15'/><text x='150' y='80' font-size='28' text-anchor='middle' fill='%23ff69b4' font-weight='bold'>单身狗认证书</text><text x='150' y='115' font-size='18' text-anchor='middle' fill='%23666'>恭喜你获得</text><text x='150' y='140' font-size='22' text-anchor='middle' fill='%23ff1493'>“快乐单身”终身成就奖</text></svg>" alt="单身狗认证书">
    </div>
    <p style="font-size:1.4rem;color:#ffd1dc;margin:10px;opacity:0;" id="blessing">11.11 快乐！单身万岁！</p>
  </div>
</div>

<script>
// ================ 工具函数 ================
const $ = (s) => document.querySelector(s);
const $$ = (s) => document.querySelectorAll(s);
const on = (el, evt, fn) => el.addEventListener(evt, fn);
const raf = requestAnimationFrame;

// ================ 场景管理 ================
class SceneManager {
  constructor() {
    this.scenes = { start: $('#startScene'), loading: $('#loadingScene'), result: $('#resultScene') };
    this.current = 'start';
  }
  show(id) {
    if (this.current === id) return;
    Object.values(this.scenes).forEach(s => s.classList.remove('active'));
    setTimeout(() => this.scenes[id].classList.add('active'), 100);
    this.current = id;
  }
}
const scene = new SceneManager();

// ================ 特效 ================
class Effects {
  static pulse(x, y) {
    const p = document.createElement('div');
    p.className = 'pulse-circle';
    p.style.left = (x - 10) + 'px';
    p.style.top = (y - 10) + 'px';
    document.body.appendChild(p);
    p.addEventListener('animationend', () => p.remove());
  }
  static float(text, x, y) {
    const el = document.createElement('div');
    el.className = 'float-particle';
    el.textContent = text;
    el.style.left = x + 'px';
    el.style.top = y + 'px';
    el.style.color = ['#ff69b4', '#ffd1dc', '#b8a6ff'][Math.floor(Math.random()*3)];
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 2000);
  }
}

// ================ 星空 ================
(function() {
  const stars = $('#stars');
  for(let i=0;i<220;i++){
    const s = document.createElement('div');
    s.style.cssText = `position:absolute;width:${Math.random()*2+1}px;height:${s.style.width};background:#fff;border-radius:50%;left:${Math.random()*100}%;top:${Math.random()*100}%;opacity:${Math.random()*0.7+0.3};animation:twinkle ${Math.random()*3+2}s infinite alternate;`;
    stars.appendChild(s);
  }
  const style = document.createElement('style');
  style.textContent = `@keyframes twinkle{0%{opacity:0.3}100%{opacity:1}}`;
  document.head.appendChild(style);
})();

// ================ 花瓣雨 (爱心) ================
const heartCanvas = $('#heartCanvas');
const hctx = heartCanvas.getContext('2d');
const resize = () => {
  heartCanvas.width = window.innerWidth;
  heartCanvas.height = window.innerHeight;
};
resize();
window.addEventListener('resize', resize);

class Heart {
  constructor() { this.reset(); }
  reset() {
    this.x = Math.random() * heartCanvas.width;
    this.y = -30;
    this.size = Math.random() * 18 + 8;
    this.speed = Math.random() * 1.5 + 0.8;
    this.vx = Math.random() * 1.5 - 0.75;
    this.rotation = 0;
    this.rotSpeed = Math.random() * 0.05 - 0.025;
  }
  draw() {
    hctx.globalAlpha = 0.9;
    hctx.fillStyle = '#ff69b4';
    hctx.save();
    hctx.translate(this.x, this.y);
    hctx.rotate(this.rotation);
    hctx.scale(this.size/30, this.size/30);
    hctx.beginPath();
    hctx.moveTo(0,10); hctx.bezierCurveTo(-10,0,-15,-10,-5,-15);
    hctx.bezierCurveTo(5,-20,15,-10,5,0); hctx.bezierCurveTo(15,10,10,20,0,10);
    hctx.closePath(); hctx.fill();
    hctx.restore();
  }
  update() {
    this.x += this.vx; this.y += this.speed; this.rotation += this.rotSpeed;
    if (this.y > heartCanvas.height) this.reset();
  }
}
const hearts = Array.from({length:28}, () => new Heart());
function animateHearts() {
  hctx.clearRect(0,0,heartCanvas.width,heartCanvas.height);
  hearts.forEach(h => { h.update(); h.draw(); });
  raf(animateHearts);
}
animateHearts();

// ================ 烟花 + 关系图 + 主流程（保持不变）============
// [省略烟花、关系图、流程代码，与上一版本完全一致，仅确保层级正确]

const fwCanvas = $('#fireworksCanvas');
const fctx = fwCanvas.getContext('2d');
fwCanvas.width = window.innerWidth; fwCanvas.height = window.innerHeight;
window.addEventListener('resize', () => { fwCanvas.width = window.innerWidth; fwCanvas.height = window.innerHeight; });

class Firework {
  constructor() { this.reset(); }
  reset() {
    this.x = Math.random() * fwCanvas.width;
    this.y = fwCanvas.height;
    this.targetY = Math.random() * fwCanvas.height * 0.4;
    this.speed = Math.random() * 3 + 2;
    this.exploded = false;
    this.particles = [];
    this.color = `hsl(${Math.random()*60 + 300},100%,70%)`;
  }
  update() {
    if (!this.exploded) {
      this.y -= this.speed;
      if (this.y <= this.targetY) this.explode();
    } else {
      this.particles.forEach(p => {
        p.x += p.vx; p.y += p.vy; p.vy += 0.12; p.life--;
      });
      this.particles = this.particles.filter(p => p.life > 0);
    }
  }
  explode() {
    this.exploded = true;
    for(let i=0;i<90;i++){
      const angle = Math.PI*2*i/90;
      const vel = Math.random()*6+4;
      this.particles.push({
        x:this.x, y:this.y,
        vx: Math.cos(angle)*vel,
        vy: Math.sin(angle)*vel,
        life: 70 + Math.random()*50,
        color: this.color
      });
    }
  }
  draw() {
    if (!this.exploded) {
      fctx.fillStyle = '#fff';
      fctx.beginPath(); fctx.arc(this.x,this.y,3,0,Math.PI*2); fctx.fill();
    } else {
      this.particles.forEach(p => {
        fctx.globalAlpha = p.life/120;
        fctx.fillStyle = p.color;
        fctx.fillRect(p.x-2,p.y-2,4,4);
      });
    }
  }
}
const fireworks = [];
function animateFireworks() {
  if (fwCanvas.style.display !== 'none') {
    fctx.fillStyle = 'rgba(10,10,30,0.15)'; fctx.fillRect(0,0,fwCanvas.width,fwCanvas.height);
    if (Math.random()<0.18) fireworks.push(new Firework());
    fireworks.forEach((f,i) => { f.update(); f.draw(); if(f.exploded && f.particles.length===0) fireworks.splice(i,1); });
  }
  raf(animateFireworks);
}
animateFireworks();

const graphCanvas = $('#graphCanvas');
const gctx = graphCanvas.getContext('2d');
graphCanvas.width = Math.min(window.innerWidth * 0.9, 600);
graphCanvas.height = 400;
window.addEventListener('resize', () => {
  graphCanvas.width = Math.min(window.innerWidth * 0.9, 600);
});

class Node {
  constructor() {
    this.x = Math.random() * graphCanvas.width;
    this.y = Math.random() * graphCanvas.height;
    this.vx = (Math.random() - 0.5) * 0.6;
    this.vy = (Math.random() - 0.5) * 0.6;
    this.r = Math.random() * 2.5 + 1.5;
    this.pulse = Math.random() * Math.PI * 2;
    this.isUser = Math.random() < 0.06;
    this.connections = 0;
  }
  update() {
    this.x += this.vx; this.y += this.vy;
    if (this.x < 0 || this.x > graphCanvas.width) this.vx *= -1;
    if (this.y < 0 || this.y > graphCanvas.height) this.vy *= -1;
    this.pulse += 0.05;
  }
}

let nodes = [], edges = [];
const NODE_COUNT = 50;

function initGraph() {
  nodes = Array.from({length: NODE_COUNT}, () => new Node());
  edges = [];
  for(let i=0;i<NODE_COUNT;i++){
    for(let j=i+1;j<NODE_COUNT;j++){
      const dist = Math.hypot(nodes[i].x-nodes[j].x, nodes[i].y-nodes[j].y);
      if(dist < 130 && Math.random() < 0.28) {
        const strength = 1 - dist/130;
        edges.push({a:i, b:j, strength});
        nodes[i].connections++; nodes[j].connections++;
      }
    }
  }
}

function drawGraph() {
  gctx.clearRect(0,0,graphCanvas.width,graphCanvas.height);
  edges.forEach(e=>{
    const n1 = nodes[e.a], n2 = nodes[e.b];
    const alpha = e.strength * 0.7;
    gctx.strokeStyle = `rgba(100, 255, 255, ${alpha})`;
    gctx.lineWidth = e.strength * 1.8;
    gctx.beginPath();
    gctx.moveTo(n1.x, n1.y);
    gctx.lineTo(n2.x, n2.y);
    gctx.stroke();
  });
  nodes.forEach(n=>{
    const pulseSize = n.r + Math.sin(n.pulse)*1.2;
    const brightness = n.connections > 3 ? '#ff69b4' : '#b8a6ff';
    gctx.fillStyle = brightness;
    gctx.shadowBlur = n.isUser ? 25 : 10;
    gctx.shadowColor = n.isUser ? '#ff1493' : '#9370db';
    gctx.beginPath();
    gctx.arc(n.x, n.y, pulseSize, 0, Math.PI*2);
    gctx.fill();
    gctx.shadowBlur = 0;
  });
}

function animateGraph() {
  if (graphCanvas.parentElement.style.display !== 'none') {
    nodes.forEach(n => n.update());
    if (Math.random() < 0.035) initGraph();
    drawGraph();
  }
  raf(animateGraph);
}
animateGraph();

// ================ 启动页文字 ================
$$('.subtitle').forEach(el => {
  setTimeout(() => el.classList.add('show'), +el.dataset.delay);
});

// ================ 主流程 ================
on($('#startBtn'), 'click', (e) => {
  const rect = e.target.getBoundingClientRect();
  Effects.pulse(rect.left + rect.width/2, rect.top + rect.height/2);
  scene.show('loading');
  $('#progressContainer').style.display = 'block';
  $('#graphContainer').style.display = 'block';
  $('.scan-line').style.opacity = '1';
  initGraph();

  let progressVal = 0;
  let phase = 1;
  const tips = [
    `正在构建高维社交关系图…`,
    `量子匹配引擎已启动…`,
    `扫描 114514 条潜在灵魂链路…`,
    `发现高维共振信号…`,
    `匹配成功率 99.999%！`
  ];
  $('#tip').textContent = tips[0];

  const interval = setInterval(() => {
    progressVal += Math.random() * 2.8 + 1.3;
    $('#progress').style.width = progressVal + '%';
    
    if (progressVal >= 22 && phase===1) { $('#tip').textContent = tips[1]; phase=2; }
    if (progressVal >= 48 && phase===2) { $('#tip').textContent = tips[2]; phase=3; }
    if (progressVal >= 72 && phase===3) { $('#tip').textContent = tips[3]; phase=4; }
    if (progressVal >= 99 && phase===4) {
      clearInterval(interval);
      setTimeout(() => {
        scene.show('result');
        $('#doggo').style.opacity = '1'; $('#doggo').style.transform = 'scale(1)';
        $('#finalText').classList.add('show');
        
        setTimeout(() => {
          $('#finalText').innerHTML = `<strong style="font-size:2.4rem">一只单身狗！</strong> <span style="font-size:1.5rem">Woof!</span>`;
          $('#doggo').style.animation = 'wiggle .35s infinite alternate';
          
          setTimeout(() => {
            $('#meme').classList.add('show');
            $('#blessing').style.opacity = '1';
            $('#heartCanvas').style.display = 'none';
            $('#fireworksCanvas').style.display = 'block';
            
            for(let i=0;i<15;i++){
              setTimeout(() => {
                Effects.float('Woof!', Math.random()*window.innerWidth, Math.random()*window.innerHeight*0.6 + 200);
              }, i*150);
            }
          }, 800);
        }, 1800);
      }, 600);
    }
  }, 90);
});
</script>
</body>
</html>
